<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self'"
        />
        <meta
            http-equiv="X-Content-Security-Policy"
            content="default-src 'self'; script-src 'self'"
        /> -->
    <title>SETA TTS</title>

    <!-- Materialize CSS -->
    <link id="materialize-link" rel="stylesheet" href="./res/static/materialize.min.css" />

    <!-- Custom CSS -->
    <link id="gui-link" rel="stylesheet" href="./res/static/gui.css" />
  </head>
  <body>
    <nav>
      <div class="nav-wrapper">
        <div class="container">
          <a href="#" class="brand-logo" tabindex="-1">SETA TTS</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="#" id="close-btn">Chiudi</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div id="voices-loading" style="display: flex; margin-top: 3rem" class="row">
        <div style="margin-left: auto; margin-right: auto" class="col s12 m10">
          <div class="card">
            <div class="card-content">
              <span style="display: flex; align-items: center" class="card-title">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  style="
                    margin-right: 0.5rem;
                    background: rgb(255, 255, 255);
                    display: block;
                    shape-rendering: auto;
                  "
                  width="24px"
                  height="24px"
                  viewBox="0 0 100 100"
                  preserveAspectRatio="xMidYMid"
                >
                  <circle
                    cx="50"
                    cy="50"
                    fill="none"
                    stroke="#ee6e73"
                    stroke-width="10"
                    r="35"
                    stroke-dasharray="164.93361431346415 56.97787143782138"
                  >
                    <animateTransform
                      attributeName="transform"
                      type="rotate"
                      repeatCount="indefinite"
                      dur="1s"
                      values="0 50 50;360 50 50"
                      keyTimes="0;1"
                    />
                  </circle>
                </svg>
                Caricamento voci...
              </span>
              <div>
                <p style="margin-top: 1rem">Sto cercando le voci installate su questo computer</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="csv-upload-container hide">
        <h1 style="text-align: center">Carica CSV</h1>

        <div id="file-drop">
          <p id="csv-info">Fai un drag and drop del CSV oppure</p>
          <a class="waves-effect waves-light btn" id="file-picker">Scegli file</a>
        </div>

        <div id="voices-status" style="display: flex; margin-top: 3rem" class="row">
          <div style="margin-left: auto; margin-right: auto" class="col s12 m10">
            <div class="card">
              <div class="card-content">
                <span style="display: flex; align-items: center" class="card-title">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="green"
                    style="margin-right: 0.5rem"
                    class="voice-ok hide"
                  >
                    <path
                      d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.959 17l-4.5-4.319 1.395-1.435 3.08 2.937 7.021-7.183 1.422 1.409-8.418 8.591z"
                    />
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="red"
                    style="margin-right: 0.5rem"
                    class="voice-error hide"
                  >
                    <path
                      d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.151 17.943l-4.143-4.102-4.117 4.159-1.833-1.833 4.104-4.157-4.162-4.119 1.833-1.833 4.155 4.102 4.106-4.16 1.849 1.849-4.1 4.141 4.157 4.104-1.849 1.849z"
                    />
                  </svg>
                  <span class="voice-ok hide">Voce installata correttamente</span>
                  <span class="voice-error hide">Voce non trovata</span>
                </span>
                <div>
                  <p class="voice-error hide">
                    È necessario installare la voce
                    <span id="voice-name">Loquendo Roberto</span>
                  </p>
                  <ul style="margin-top: 2rem" class="collapsible">
                    <li class="active">
                      <div class="collapsible-header">Voci installate</div>
                      <div style="padding: 1rem" class="collapsible-body">
                        <span id="voices-list"></span>
                      </div>
                    </li>
                  </ul>
                  <!-- <p style="margin-top: 1rem">Voci installate:</p>
                  <div id="voices-list"></div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- hide -->
      <div class="csv-file-container hide" style="padding-bottom: 3rem">
        <div style="display: flex; align-items: center">
          <a class="waves-effect waves-light btn" id="new-file">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
              <path d="M0 12l9-8v6h15v4h-15v6z" fill="white" />
            </svg>
          </a>
          <h2 id="file-name">nome_file_bello_e_figo.csv</h2>
        </div>

        <ul class="collapsible">
          <li>
            <div class="collapsible-header">
              Anteprima
              <span style="margin-left: auto">
                <svg
                  class="accordion-arrow"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                >
                  <path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" />
                </svg>
              </span>
            </div>

            <div class="collapsible-body table-container">
              <table id="preview-table" class="stripped">
                <thead>
                  <tr id="table-thead-tr"></tr>
                </thead>
                <tbody id="table-tbody"></tbody>
              </table>
              <p id="hidden-rows-num" class="hide" style="color: darkgray"></p>
            </div>
          </li>
        </ul>

        <div class="row">
          <div style="margin-top: 4rem" class="col s12">
            <h5 style="margin-bottom: 1rem; font-weight: 500">TTS</h5>
            <p>
              Per ogni riga verrà generato un file audio. Puoi scegliere il testo da far
              pronunciare, il nome del file e le impostazioni di codifica.
            </p>
            <p>
              Sono state rilevate
              <span id="header-num">x</span>
              colonne:
              <span id="headers"></span>
              che puoi usare come variabili all'interno di parentesi graffe.
            </p>
            <p>
              Se, per esempio, la prima colonna equivale al nome della fermata e vuoi che venga
              pronunciata la frase
              <i>&quot;Prossima fermata: &lt;nome fermata&gt;&quot;,</i>
              ti basterà scrivere
              <i>
                Prossima fermata: {
                <span class="first-col">nome prima colonna</span>
                }
              </i>
            </p>
            <p>
              Oppure se equivale al codice della fermata e vuoi che il file venga salvato come
              <i>&lt;codicefermata&gt;.mp3</i>
              , nell'apposita casella di testo metterai
              <i>
                {
                <span class="first-col">nome prima colonna</span>
                }
              </i>
            </p>

            <div class="row" style="margin-top: 3rem; margin-bottom: 0">
              <div class="input-field col s12">
                <input id="tts-string-input" type="text" />
                <label for="tts-string-input">Testo da pronunciare</label>
                <small id="tts-string-preview-container">
                  Il primo file sarà il TTS di
                  <span id="tts-string-preview" style="font-weight: 600">-</span>
                </small>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s8">
                <input id="file-name-input" type="text" />
                <label for="file-name-input">Nome del file</label>
                <small id="file-name-preview-container">
                  Il primo file sarà chiamato
                  <span id="file-name-preview" style="font-weight: 600">-</span>
                </small>
              </div>
              <div class="input-field col s4">
                <select id="audio-format-input">
                  <option value="mp3" selected>MP3</option>
                  <option value="wav">WAV</option>
                </select>
                <label for="audio-format-input">Formato audio</label>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 4rem; margin-bottom: 1rem" class="row">
          <div class="col s12">
            <h5 style="margin-bottom: 1rem; font-weight: 500">Codifica audio</h5>
            <p>
              Le impostazioni di codifica audio corrette sono: bitrate a
              <strong>24kbps,</strong>
              sample rate di
              <strong>11025Hz</strong>
              e volume al
              <strong>150%</strong>
            </p>
          </div>
        </div>

        <div class="row">
          <div style="visibility: hidden" class="col s12">
            <p id="audio-errors">-</p>
          </div>
          <div class="input-field col s6">
            <select id="bitrate">
              <option value="24k" selected>24kbps</option>
              <option value="32k">32kbps</option>
              <option value="96k">96kbps</option>
              <option value="128k">128kbps</option>
              <option value="192k">192kbps</option>
              <option value="256k">256kbps</option>
            </select>
            <label for="bitrate">Bitrate</label>
          </div>

          <div class="input-field col s6">
            <!-- prettier-ignore -->
            <select id="sample-rate">
              <option value="1000">​1 kHz​</option>​
              <option value="2000">​2 kHz​</option>​
              <option value="3000">​3 kHz​</option>​
              <option value="4000">​4 kHz​</option>​
              <option value="6000">​6 kHz​</option>​
              <option value="8000">​8 kHz​</option>​
              <option value="11025" selected>​11.025 kHz​</option>​
              <option value="12000">​12 kHz​</option>​
              <option value="16000">​16 kHz​</option>​
              <option value="22050">​22.05 kHz​</option>​
              <option value="24000">​24 kHz​</option>​
              <option value="32000">​32 kHz​</option>​
              <option value="44100">​44.1 kHz (CD)​</option>​
              <option value="48000">​48 kHz (DVD)​</option>​
              <option value="64000">​64 kHz​</option>​
              <option value="88200">​88.2 kHz​</option>​
              <option value="96000">​96 kHz​</option>​
              <option value="128000">​128 kHz​</option>​
              <option value="176400">​176.4 kHz​</option>​
              <option value="192000">​192 kHz​</option>​
              <option value="256000">​256 kHz​</option>​
              <option value="352800">​352.8 kHz​</option>​
              <option value="384000">​384 kHz​</option>​
              <option value="512000">​512 kHz​</option>​
              <option value="705600">​705.6 kHz​</option>​
              <option value="768000">​768 kHz​</option>​
              <option value="1024000">​1024 kHz​</option>​
            </select>
            <label for="sample-rate">Sample rate</label>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s6">
            <p class="range-field">
              <label for="volume">Volume</label>
              <span style="display: flex; align-items: center">
                <input type="range" id="volume" min="0" max="200" value="150" />
                <span id="volume-txt" style="padding-left: 1rem; color: #9e9e9e">150%</span>
              </span>
            </p>
          </div>

          <div class="input-field col s6">
            <div class="file-field input-field">
              <div class="btn">
                <span>Cartella di output</span>
                <input type="file" webkitdirectory id="output-path-input" />
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" id="output-path-txt" type="text" />
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 3rem" class="row">
          <div style="display: flex; align-items: center" class="col s12">
            <a id="convert" class="waves-effect waves-light btn-large">Avvia conversione</a>
            <div
              style="margin-left: 2rem"
              class="switch tooltipped"
              data-position="top"
              data-tooltip="Il TTS multithread mostra ancora qualche bug, pertanto bisogna evitare di usarlo"
            >
              <label>
                TTS multithread
                <input disabled type="checkbox" id="multithreaded-tts" />
                <span class="lever"></span>
              </label>
            </div>
            <div style="margin-left: 2rem" class="switch">
              <label>
                Codifica multithread
                <input type="checkbox" id="multithreaded-encoding" checked />
                <span class="lever"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer style="z-index: 100" class="page-footer">
      <div class="container" style="padding-top: 1rem; padding-bottom: 1rem">
        Per dubbi o problemi:
        <a style="color: inherit" href="mailto:alessandro.amella@setaweb.it">
          alessandro.amella@setaweb.it
        </a>
        <span class="right">
          commit
          <span style="font-weight: 600" id="latest-commit">-</span>
        </span>
      </div>
    </footer>

    <!-- Custom JS -->
    <script defer>
      // DEBUG - se in debug aggiungere prefisso ./build
      // console.log(require("fs").readdirSync(__dirname)); // DEBUG
      require("./build/gui/renderer.js");
    </script>
  </body>
</html>
