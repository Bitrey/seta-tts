<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self'"
        />
        <meta
            http-equiv="X-Content-Security-Policy"
            content="default-src 'self'; script-src 'self'"
        /> -->
    <title>SETA TTS</title>

    <!-- Materialize CSS -->
    <link id="materialize-link" rel="stylesheet" href="./res/static/materialize.min.css" />

    <!-- Custom CSS -->
    <link id="gui-link" rel="stylesheet" href="./res/static/gui.css" />
  </head>
  <body>
    <nav>
      <div class="nav-wrapper">
        <div class="container">
          <a href="#" class="brand-logo" tabindex="-1">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1.5rem"
              height="1.5rem"
              viewBox="0 0 24 24">
              <path
                style="fill: white"
                d="M2 6h3.828c-1.335 2.905-1.335 9.096 0 12h-3.828c-1.311-1.108-2-3.551-2-5.995 0-2.45.692-4.9 2-6.005zm22 6.005c.005 8.031-3.145 12.864-6.121 11.864-.774-.26-9.567-5.579-9.567-5.579-1.993-2.22-1.993-10.288 0-12.508 0 0 9.161-5.476 9.548-5.633 2.691-1.086 6.136 3.82 6.14 11.856zm-3.383-7.693c-1.053-2.264-3.002-2.226-4.034.002-.588 1.271-.993 3.165-1.21 4.797h.527c1.587 0 2.873 1.287 2.873 2.875s-1.286 2.875-2.873 2.875h-.515c.217 1.603.616 3.538 1.206 4.89.988 2.271 3.062 2.232 4.033-.002 1.946-4.477 1.772-11.609-.007-15.437z" />
            </svg>
            SETA TTS
          </a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li>
              <a
                style="display: flex; align-items: center; cursor: pointer"
                href="#"
                id="open-logs">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  style="margin-right: 0.4rem"
                  width="1.2rem"
                  height="1.2rem"
                  viewBox="0 0 24 24">
                  <path
                    fill="white"
                    d="M0 10v12h24v-12h-24zm0-2v-6h7c1.695 1.942 2.371 3 4 3h13v3h-2v-1h-11c-2.34 0-3.537-1.388-4.916-3h-4.084v4h-2z" />
                </svg>
                Cartella log
              </a>
            </li>
            <li>
              <a
                style="display: flex; align-items: center; cursor: pointer"
                href="#"
                id="open-console">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  style="margin-right: 0.4rem"
                  width="1.3rem"
                  height="1.3rem"
                  viewBox="0 0 24 24">
                  <path
                    fill="white"
                    d="M2.897 4.181c2.43-2.828 5.763-4.181 9.072-4.181 4.288 0 8.535 2.273 10.717 6.554-2.722.001-6.984 0-9.293 0-1.674.001-2.755-.037-3.926.579-1.376.724-2.415 2.067-2.777 3.644l-3.793-6.596zm5.11 7.819c0 2.2 1.789 3.99 3.988 3.99s3.988-1.79 3.988-3.99-1.789-3.991-3.988-3.991-3.988 1.791-3.988 3.991zm5.536 5.223c-2.238.666-4.858-.073-6.293-2.549-1.095-1.891-3.989-6.933-5.305-9.225-1.33 2.04-1.945 4.294-1.945 6.507 0 5.448 3.726 10.65 9.673 11.818l3.87-6.551zm2.158-9.214c1.864 1.734 2.271 4.542 1.007 6.719-.951 1.641-3.988 6.766-5.46 9.248 7.189.443 12.752-5.36 12.752-11.972 0-1.313-.22-2.66-.69-3.995h-7.609z" />
                </svg>
                Apri console
              </a>
            </li>
            <li>
              <a
                style="display: flex; align-items: center; cursor: pointer"
                href="#"
                id="close-btn">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  style="margin-right: 0.4rem"
                  width="1.2rem"
                  height="1.2rem"
                  viewBox="0 0 24 24">
                  <path
                    fill="white"
                    d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z" />
                </svg>
                Chiudi
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div id="voices-loading" style="display: flex; margin-top: 3rem" class="row">
        <div style="margin-left: auto; margin-right: auto" class="col s12 m10">
          <div class="card">
            <div class="card-content">
              <span style="display: flex; align-items: center" class="card-title">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  style="
                    margin-right: 0.5rem;
                    background: rgb(255, 255, 255);
                    display: block;
                    shape-rendering: auto;
                  "
                  width="24px"
                  height="24px"
                  viewBox="0 0 100 100"
                  preserveAspectRatio="xMidYMid">
                  <circle
                    cx="50"
                    cy="50"
                    fill="none"
                    stroke="#ee6e73"
                    stroke-width="10"
                    r="35"
                    stroke-dasharray="164.93361431346415 56.97787143782138">
                    <animateTransform
                      attributeName="transform"
                      type="rotate"
                      repeatCount="indefinite"
                      dur="1s"
                      values="0 50 50;360 50 50"
                      keyTimes="0;1" />
                  </circle>
                </svg>
                Caricamento voci...
              </span>
              <div>
                <p style="margin-top: 1rem">Sto cercando le voci installate su questo computer</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- hide -->
      <div class="csv-upload-container hide">
        <div style="margin-bottom: 3rem; text-align: center">
          <h1>
            <svg xmlns="http://www.w3.org/2000/svg" width="3rem" height="3rem" viewBox="0 0 24 24">
              <path
                d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z" />
            </svg>
            SETA TTS
          </h1>
          <p>
            Questo software è deputato a generare dei file audio da utilizzarsi con i sistemi di
            bordo "prossima fermata" di Reggio, Modena e Piacenza.
          </p>
          <p>
            Come input è necessario un file CSV con due colonne, idealmente la prima colonna
            <strong>ID fermata</strong>
            (MAIOR) e la seconda colonna
            <strong>denominazione fermata</strong>
            (MAIOR).
          </p>
          <p>
            Come output, il software genererà, per ogni riga appartenenete al file CSV, un file MP3
            o WAV denominato
            <strong>&lt;ID fermata&gt;.mp3</strong>
            o
            <strong>&lt;ID fermata&gt;.wav.</strong>
          </p>
        </div>

        <h1 style="text-align: center; margin-bottom: 0">
          <svg xmlns="http://www.w3.org/2000/svg" width="3rem" height="3rem" viewBox="0 0 24 24">
            <path d="M8 10h-5l9-10 9 10h-5v10h-8v-10zm11 9v3h-14v-3h-2v5h18v-5h-2z" />
          </svg>
          Carica CSV
        </h1>
        <p style="text-align: center; margin-bottom: 1.5rem">
          Assicurati (dal pannello sottostante) che le voci desiderate siano state installate
        </p>

        <div id="file-drop">
          <!-- Fai un drag and drop del CSV oppure -->
          <p id="csv-info"></p>
          <a class="waves-effect waves-light btn" id="file-picker">Scegli file</a>
        </div>

        <div id="voices-status" style="display: flex; margin-top: 3rem" class="row">
          <div style="margin-left: auto; margin-right: auto" class="col s12 m10">
            <div class="card">
              <div class="card-content">
                <span style="display: flex; align-items: center" class="card-title">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="green"
                    style="margin-right: 0.5rem"
                    class="voice-ok hide">
                    <path
                      d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.959 17l-4.5-4.319 1.395-1.435 3.08 2.937 7.021-7.183 1.422 1.409-8.418 8.591z" />
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="red"
                    style="margin-right: 0.5rem"
                    class="voice-error hide">
                    <path
                      d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.151 17.943l-4.143-4.102-4.117 4.159-1.833-1.833 4.104-4.157-4.162-4.119 1.833-1.833 4.155 4.102 4.106-4.16 1.849 1.849-4.1 4.141 4.157 4.104-1.849 1.849z" />
                  </svg>
                  <span class="voice-ok hide">Tutto OK!</span>
                  <span class="voice-error hide">Qualcosa non va :(</span>
                </span>
                <div>
                  <p class="voice-msg"></p>
                  <div id="install-voices-container" style="margin-top: 1rem" class="hide"></div>
                  <p id="install-voice-status"></p>
                  <a class="waves-effect waves-light btn hide" id="select-voice-path">
                    Installazione terminata
                  </a>

                  <ul id="voices-collapsible" style="margin-top: 2rem" class="collapsible">
                    <li>
                      <div class="collapsible-header">
                        Voci installate
                        <span style="margin-left: auto">
                          <svg
                            id="voices-collapsible-arrow"
                            class="accordion-arrow"
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24">
                            <path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" />
                          </svg>
                        </span>
                      </div>
                      <div style="padding: 1rem" class="collapsible-body">
                        <span id="voices-list"></span>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- hide -->
      <div class="csv-file-container hide" style="padding-bottom: 3rem">
        <div style="display: flex; align-items: center">
          <a class="waves-effect waves-light btn" id="new-file">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
              <path d="M0 12l9-8v6h15v4h-15v6z" fill="white" />
            </svg>
          </a>
          <h2 id="file-name">nome_file_bello_e_figo.csv</h2>
        </div>

        <ul id="preview-collapsible" class="collapsible">
          <li>
            <div class="collapsible-header">
              Anteprima
              <span style="margin-left: auto">
                <svg
                  id="preview-collapsible-arrow"
                  class="accordion-arrow"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24">
                  <path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" />
                </svg>
              </span>
            </div>

            <div class="collapsible-body table-container">
              <table id="preview-table" class="stripped">
                <thead>
                  <tr id="table-thead-tr"></tr>
                </thead>
                <tbody id="table-tbody"></tbody>
              </table>
              <p id="hidden-rows-num" class="hide" style="color: darkgray"></p>
            </div>
          </li>
        </ul>

        <div style="margin-top: 4rem" class="row">
          <div class="col s12">
            <h5 style="margin-bottom: 1rem; font-weight: 500">Voce</h5>
          </div>
          <div class="input-field col s12">
            <select id="voice-select">
              <option value="Loquendo Roberto" selected>Loquendo Roberto</option>
              <option value="Loquendo Paola">Loquendo Paola</option>
            </select>
            <label for="voice-select">
              Seleziona la voce (se non è installata, i file audio saranno vuoti)
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col s12">
            <h5 style="margin-bottom: 1rem; font-weight: 500">TTS</h5>
            <p>
              Per ogni riga verrà generato un file audio. Puoi scegliere il testo da far
              pronunciare, il nome del file e le impostazioni di codifica.
            </p>
            <!-- prettier-ignore -->
            <p style="margin-bottom: 1.5rem;">
              Sono state rilevate
              <span id="header-num">x</span>
              colonne:
              <span id="headers"></span>
              che puoi usare come
              <i>variabili</i>
              all'interno di
              <i>parentesi graffe</i>.
            </p>
            <!-- prettier-ignore -->
            <p>
              Se, per esempio, la seconda colonna (<span class="second-col">nome seconda colonna</span>)
              equivale al nome della fermata e vuoi che venga pronunciata la frase
              <strong>
                <i>
                  &quot;&lt;nome fermata&gt;, indossa la mascherina e mantieni le distanze&quot;
                </i>
              </strong>
              ti basterà scrivere
              <strong>
                <i>
                  &quot;{
                  <span class="second-col">nome seconda colonna</span>
                  }, indossa la mascherina e mantieni le distanze&quot;
                </i>
              </strong>.
            </p>
            <!-- prettier-ignore -->
            <p>
              Oppure se la prima colonna (<span class="first-col">nome prima colonna</span>)
              equivale al codice della fermata e vuoi che il file venga salvato come
              <strong><i>&quot;&lt;codicefermata&gt;.wav&quot;</i></strong>,
              nell'apposita casella di testo metterai
              <strong>
                <i>
                  &quot;{
                  <span class="first-col">nome prima colonna</span>
                  }&quot;
                </i>
              </strong>
              e selezionerai
              <strong>Formato audio</strong>
              come
              <strong>WAV</strong>.
            </p>

            <div class="row" style="margin-top: 3rem; margin-bottom: 0">
              <div class="input-field col s12">
                <input id="tts-string-input" type="text" value="Testo da pronunciare" />
                <label for="tts-string-input">Testo da pronunciare</label>
                <small id="tts-string-preview-container">
                  Il primo file sarà il TTS di
                  <span id="tts-string-preview" style="font-weight: 600">-</span>
                </small>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s8">
                <input id="file-name-input" type="text" value="Nome del file" />
                <label for="file-name-input">Nome del file</label>
                <small id="file-name-preview-container">
                  Il primo file sarà chiamato
                  <span id="file-name-preview" style="font-weight: 600">-</span>
                </small>
              </div>
              <div class="input-field col s4">
                <select id="audio-format-input">
                  <option value="mp3" selected>MP3</option>
                  <option value="wav">WAV</option>
                </select>
                <label for="audio-format-input">Formato audio</label>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 4rem; margin-bottom: 1rem" class="row">
          <div class="col s12">
            <h5 style="margin-bottom: 1rem; font-weight: 500">Codifica audio</h5>
            <p>
              Le impostazioni di codifica audio corrette per Modena sono bitrate a
              <strong>88kbps</strong>
              e sample rate di
              <strong>11025Hz.</strong>
            </p>
            <p>
              Per Reggio e Piacenza il bitrate corretto è di
              <strong>256kbps.</strong>
            </p>
          </div>
        </div>

        <div class="row">
          <div style="visibility: hidden" class="col s12">
            <p id="audio-errors">-</p>
          </div>
          <div class="input-field col s6">
            <select id="bitrate">
              <option value="24k">24kbps</option>
              <option value="32k">32kbps</option>
              <option value="88k" selected>88kbps</option>
              <option value="96k">96kbps</option>
              <option value="128k">128kbps</option>
              <option value="192k">192kbps</option>
              <option value="256k">256kbps</option>
            </select>
            <label for="bitrate">Bitrate</label>
          </div>

          <div class="input-field col s6">
            <!-- prettier-ignore -->
            <select id="sample-rate">
              <option value="1000">​1 kHz​</option>​
              <option value="2000">​2 kHz​</option>​
              <option value="3000">​3 kHz​</option>​
              <option value="4000">​4 kHz​</option>​
              <option value="6000">​6 kHz​</option>​
              <option value="8000">​8 kHz​</option>​
              <option value="11025" selected>​11.025 kHz​</option>​
              <option value="12000">​12 kHz​</option>​
              <option value="16000">​16 kHz​</option>​
              <option value="22050">​22.05 kHz​</option>​
              <option value="24000">​24 kHz​</option>​
              <option value="32000">​32 kHz​</option>​
              <option value="44100">​44.1 kHz (CD)​</option>​
              <option value="48000">​48 kHz (DVD)​</option>​
              <option value="64000">​64 kHz​</option>​
              <option value="88200">​88.2 kHz​</option>​
              <option value="96000">​96 kHz​</option>​
              <option value="128000">​128 kHz​</option>​
              <option value="176400">​176.4 kHz​</option>​
              <option value="192000">​192 kHz​</option>​
              <option value="256000">​256 kHz​</option>​
              <option value="352800">​352.8 kHz​</option>​
              <option value="384000">​384 kHz​</option>​
              <option value="512000">​512 kHz​</option>​
              <option value="705600">​705.6 kHz​</option>​
              <option value="768000">​768 kHz​</option>​
              <option value="1024000">​1024 kHz​</option>​
            </select>
            <label for="sample-rate">Sample rate</label>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s6">
            <p class="range-field">
              <label for="volume">Volume</label>
              <span style="display: flex; align-items: center">
                <input type="range" id="volume" min="0" max="200" value="100" />
                <span id="volume-txt" style="padding-left: 1rem; color: #9e9e9e">100%</span>
              </span>
            </p>
          </div>

          <div class="input-field col s6">
            <div class="file-field input-field">
              <div class="btn">
                <span>Cartella di output</span>
                <input type="file" webkitdirectory id="output-path-input" />
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" id="output-path-txt" type="text" />
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 3rem" class="row">
          <div style="display: flex; align-items: center" class="col s12">
            <a id="convert" class="waves-effect waves-light btn-large">Avvia conversione</a>
            <div
              style="margin-left: 2rem"
              class="switch tooltipped"
              data-position="top"
              data-tooltip="Il TTS multithread mostra ancora qualche bug, pertanto bisogna evitare di usarlo">
              <label for="multithreaded-tts">
                TTS multithread
                <input disabled type="checkbox" id="multithreaded-tts" />
                <span class="lever"></span>
              </label>
            </div>
            <div
              style="margin-left: 2rem"
              class="switch tooltipped"
              data-position="top"
              data-tooltip="Utilizza più thread del processore in modo da velocizzare i tempi di codifica">
              <label for="multithreaded-encoding">
                Codifica multithread
                <input type="checkbox" id="multithreaded-encoding" checked />
                <span class="lever"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer style="z-index: 100" class="page-footer">
      <div class="container" style="padding-top: 1rem; padding-bottom: 1rem">
        Per dubbi o problemi:
        <a style="color: inherit; cursor: pointer" href="mailto:alessandro.amella@setaweb.it">
          alessandro.amella@setaweb.it
        </a>
        <span class="right">
          commit
          <span style="font-weight: 600" id="latest-commit">-</span>
        </span>
      </div>
    </footer>

    <!-- Custom JS -->
    <script>
      require("./build/gui/renderer.js");
    </script>
  </body>
</html>
